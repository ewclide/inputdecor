"use strict";var _get=function a(b,c,d){null===b&&(b=Function.prototype);var f=Object.getOwnPropertyDescriptor(b,c);if(f===void 0){var g=Object.getPrototypeOf(b);return null===g?void 0:a(g,c,d)}if("value"in f)return f.value;var h=f.get;return void 0===h?void 0:h.call(d)},_createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a};function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}(function(){function checkBoolean(a,b){return"string"==typeof a?"true"==a?a=!0:"false"==a?a=!1:a=b:void 0==a&&(a=b),a}var DOC={create:function(b,c,d){var f=$(document.createElement(b));return"string"==typeof c?f.addClass(c):"object"==("undefined"==typeof c?"undefined":_typeof(c))&&f.attr(c),d&&f.css(d),f}},Box=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"create",value:function(c){var d=this;this.$element.hide(),this.box=DOC.create("div","inputdecor-"+c),this.button=DOC.create("div","button "+(!!this.active&&"active")),this.label=DOC.create("span","label"),this.$element.before(this.box),this.box.append(this.button),this.button.append(this.label),this.box.append(this.$element),this.button.bind("click",function(){d.toogle()})}},{key:"activate",value:function(){this.button.addClass("active"),this.$element.prop({checked:!0}),this.$element.change(),this.active=!0}},{key:"deactivate",value:function(){this.button.removeClass("active"),this.$element.prop({checked:!1}),this.$element.change(),this.active=!1}},{key:"toogle",value:function(){this.active?this.deactivate():this.activate()}}]),a}(),Checkbox=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.init(c),_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"create",d).call(d,"checkbox"),d}return _inherits(b,a),_createClass(b,[{key:"init",value:function(d){var f=this;this.$element=d,this.name=d.attr("name"),this.value=d.val(),this.active=function(){var g=f.$element.prop("checked")||f.$element.attr("checked");return!!g}()}}]),b}(Box),Radio=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),f=d;return d.init(c),_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"create",d).call(d,"radio"),d.button.unbind("click"),d.button.bind("click",function(){f.remove||f.active?f.remove&&f.toogle():f.activate()}),d}return _inherits(b,a),_createClass(b,[{key:"init",value:function(d){var f=this;this.$element=d,this.name=d.attr("name"),this.value=d.val(),this.active=function(){var g=f.$element.prop("checked")||f.$element.attr("checked");return!!g}(),this.remove=checkBoolean(f.$element.attr("data-remove"),!1),this.radios=$("input[type=radio][name=\""+this.name+"\"]"),this.$element[0].inputdecor=this}},{key:"deactiveOther",value:function(d){this.radios.each(function(){this.inputdecor!==d&&this.inputdecor.deactivate()})}},{key:"activate",value:function(){_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"activate",this).call(this),this.deactiveOther(this)}}]),b}(Box),Select=function(){function Select(a){_classCallCheck(this,Select);this;this.$elements={main:a},this.settings={type:a[0].tagName.toLowerCase(),active:!1,name:a.attr("name"),value:a.val(),speed:parseInt(a.attr("data-speed"))||250,rollup:a.attr("data-rollup")||!1,class:a.attr("data-class")||"",unselected:a.attr("data-unselected")||!1,selectedIndex:a.attr("data-selected-index"),unselectedText:a.attr("data-unselected-text")||"not selected",buttonText:a.attr("data-button-text")||"select from list",changeFunc:a.attr("data-onchange")||function(){}},this.options=[],this._build()}return _createClass(Select,[{key:"_getIndex",value:function(){return"select"==this.settings.type?this.$elements.main[0].selectedIndex:"ul"==this.settings.type?this.$elements.main.find("li[selected]").index():void 0}},{key:"_createList",value:function(b){"select"==this.settings.type?(this.settings.unselected&&this.$elements.main.prepend("<option>"+this.settings.unselectedText+"</option>"),this._appendOptions(b,"option")):"ul"==this.settings.type&&(this.settings.unselected&&this.$elements.main.prepend("<li>"+this.settings.unselectedText+"</li>"),this._appendOptions(b,"li"))}},{key:"_appendOptions",value:function(b,c){var d=this,f=this.$elements.main.find(c);f.length&&f.each(function(){var g=$(this),h=g.text(),j=DOC.create("li").text(h);d.options.push({$element:j,value:g.val()||g.attr("value"),text:h}),b.append(j)})}},{key:"_build",value:function(){var self=this,$elements=this.$elements,settings=this.settings;$elements.main.hide(),settings.changeFunc=eval("(function(){ return "+settings.changeFunc+"})()"),$elements.select=DOC.create("div","inputdecor-select "+(settings.class?settings.class:"")),$elements.button=DOC.create("button","button"),$elements.label=DOC.create("span","label"),$elements.marker=DOC.create("span","marker"),$elements.hidden=DOC.create("input",{type:"hidden",name:settings.name}).val(settings.value),$elements.list=DOC.create("ul","list"),$elements.wrapper=DOC.create("div","list-wrapper",{position:"absolute",width:"100%",transform:"scaleY(0)","transform-origin":"100% 0",transition:settings.speed+"ms"}),$elements.main.before($elements.select),$elements.select.append($elements.hidden),$elements.select.append($elements.button),$elements.select.append($elements.label.append($elements.marker)),$elements.select.append($elements.wrapper.append($elements.list)),this._createList($elements.list),settings.rollup&&($elements.rollup=DOC.create("span","rollup"),$elements.list.append($elements.rollup),$elements.rollup.click(function(){self.close()})),settings.buttonText&&$elements.button.text(settings.buttonText),1>=this.options.length?($elements.select.addClass("empty"),this.choose(0)):settings.selectedIndex?this.choose(settings.selectedIndex):this.choose(this._getIndex()),$elements.button[0].onclick=function(){self.toogle()},$elements.label[0].onclick=function(){self.toogle()},$elements.list.click(function(a){var b;b="LI"==a.target.tagName?$(a.target):$(a.target).closest("li"),b.length&&self.choose(b.index())}),document.body.addEventListener("click",function(a){var b=$(a.target).closest(".inputdecor-select");b.length||self.close()})}},{key:"choose",value:function(b){var c=this.options[b];if(this.options.forEach(function(f){f.$element.removeAttr("selected")}),c.$element.attr("selected",""),c.text==this.settings.unselectedText){var d=this.settings.buttonText||this.settings.unselectedText;this.$elements.hidden.val(""),this.$elements.button.text(d)}else this.$elements.hidden.val(c.value),this.$elements.button.text(c.text);this.$elements.main[0].selectedIndex=b,this.$elements.main.change(),this.settings.changeFunc(c.value),this.close()}},{key:"open",value:function(){1<this.options.length&&(this.$elements.wrapper.css("transform","scaleY(1)"),this.$elements.button.addClass("active"),this.$elements.label.addClass("active"),this.settings.active=!0)}},{key:"close",value:function(){1<this.options.length&&(this.$elements.wrapper.css("transform","scaleY(0)"),this.$elements.button.removeClass("active"),this.$elements.label.removeClass("active"),this.settings.active=!1)}},{key:"toogle",value:function(){this.settings.active?this.close():this.open()}}]),Select}(),File=function(){function a(b){_classCallCheck(this,a);this;this.$element=b,this.$elements={},this.settings={textButton:this.$element.attr("data-text-button")||"\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u0444\u0430\u0439\u043B",textUnselected:this.$element.attr("data-text-unselected")||"\u0444\u0430\u0439\u043B \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D",class:this.$element.attr("data-class")||!1,close:this.$element.attr("data-close")||!1,size:this.$element.attr("data-size")||!1,maxCount:this.$element.attr("data-max-count")||3},this._create(this.settings)}return _createClass(a,[{key:"_create",value:function(c){var d=this,f=this.$elements;this.$element.hide(),f.wrapper=DOC.create("div","inputdecor-file "+(c.class?c.class:"")),f.unselected=DOC.create("span","unselected").text(c.textUnselected),f.list=DOC.create("div","files-list"),f.close=DOC.create("span","close"),f.close[0].onclick=function(){d._hideFiles()},f.button=DOC.create("button","button").text(c.textButton).click(function(g){g.preventDefault(),d.$element.click()}),this.$element.after(f.wrapper),f.wrapper.append(f.button),f.wrapper.append(f.list),f.list.append(f.unselected),f.wrapper.append(this.$element),this.$element.change(function(){if(d.$element[0].files){var h=d._getFiles(d.$element[0].files);d._showFiles(h)}})}},{key:"_getFiles",value:function(c){for(var d=[],f=0;f<c.length;f++)d.push(c[f]);return d}},{key:"_showFiles",value:function(c){for(var d="",f=0;f<c.length;f++)if(d+="<div class='file'><label>"+c[f].name+"</label>",this.settings.size&&(d+="<span>"+Math.round(c[f].size/1024)+"kb</span>"),d+="</div>",f>=this.settings.maxCount)return this._hideFiles(),void alert("\u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u043E\u0435 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0444\u0430\u0439\u043B\u043E\u0432 - "+this.settings.maxCount+"!");this.$elements.list.empty(),this.$elements.list.append(d),this.settings.close?this.$elements.list.append(this.$elements.close):this.$elements.list.append("<span></span>")}},{key:"_hideFiles",value:function(){this.$element.val(""),this.$elements.list.empty(),this.$elements.list.append(this.$elements.unselected)}}]),a}(),Decorator=function a(b){_classCallCheck(this,a);var c=b.attr("type")||b[0].tagName.toLowerCase();"ul"==c||"select"==c?this.input=new Select(b):"checkbox"==c?this.input=new Checkbox(b):"radio"==c?this.input=new Radio(b):"file"==c&&(this.input=new File(b))};$.fn.decorate=function(){this.each(function(){this.binder=new Decorator($(this))})},$(document).ready(function(){$(".inputdecor").decorate()})})();