"use strict";function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _get=function e(t,n,i){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,n);if(void 0===s){var l=Object.getPrototypeOf(t);return null===l?void 0:e(l,n,i)}if("value"in s)return s.value;var a=s.get;if(void 0!==a)return a.call(i)},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(){function checkBoolean(e,t){return"string"==typeof e?e="true"==e||"false"!=e&&t:void 0==e&&(e=t),e}function getAllAttrs(e){for(var t={},n=e[0].attributes,i=0;i<n.length;i++)t[n[i].name]=n[i].value;return t}var DOC={create:function(e,t,n){var i=$(document.createElement(e));return"string"==typeof t?i.addClass(t):"object"==(void 0===t?"undefined":_typeof(t))&&i.attr(t),n&&i.css(n),i}},Box=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"create",value:function(e){var t=this;this.$element.hide(),this.box=DOC.create("div","inputdecor-"+e),this.button=DOC.create("div","button "+(!!this.active&&"active")),this.$element.before(this.box),this.box.append(this.button),this.box.append(this.$element),this.button.bind("click",function(){t.toogle()})}},{key:"activate",value:function(){this.button.addClass("active"),this.$element.prop({checked:!0}),this.$element.change(),this.active=!0}},{key:"deactivate",value:function(){this.button.removeClass("active"),this.$element.prop({checked:!1}),this.$element.change(),this.active=!1}},{key:"toogle",value:function(){this.active?this.deactivate():this.activate()}}]),e}(),Decorator=function e(t){_classCallCheck(this,e);var n=t.attr("type")||t[0].tagName.toLowerCase();"ul"==n||"select"==n?this.input=new Select(t):"checkbox"==n?this.input=new Checkbox(t):"radio"==n?this.input=new Radio(t):"file"==n&&(this.input=new File(t))},File=function(){function e(t){_classCallCheck(this,e),this.init(t)}return _createClass(e,[{key:"init",value:function(e){this.$element=e,this.files=[],this.settings={text:this.$element.attr("data-text")||"Выберите файл",multiple:this.$element.attr("data-multiple")||!1,filesCount:this.$element.attr("data-files-count")||!1,maxSize:this.$element.attr("data-max-size")||!1,maxSumSize:this.$element.attr("data-max-sumsize")||!1,drop:this.$element.attr("data-drop")||!1,class:this.$element.attr("data-class")||!1},this.create(this.settings)}},{key:"create",value:function(e){var t=this;this.$element.hide(),e.multiple&&this.$element[0].setAttribute("multiple","");var n=DOC.create("div","inputdecor-file "+(!!e.class&&e.class));this.filesList=DOC.create("div","files-list"),this.button=DOC.create("button","button").text(e.text),this.button.click(function(){t.$element.click()}),this.$element.after(n),n.append(this.button),n.append(this.filesList),n.append(this.$element),this.$element.change(function(e){t.$element[0].files&&(t.files=t.getFiles(t.$element[0].files),t.showFiles(t.files),t.$element.val(""))})}},{key:"getFiles",value:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t}},{key:"showFiles",value:function(e){var t=this,n=$(document.createElement("ul")),i="",s=0;e.length>t.settings.filesCount?i="Максимальное количество файлов - "+t.settings.filesCount:e.forEach(function(e){if(t.settings.maxSumSize&&(s+=e.size),s&&s>t.settings.maxSumSize)i="Превышен суммарный размер файлов.\nМаксимальный суммареый размер - "+Math.round(t.settings.maxSumSize/1024)+"kb";else if(t.settings.maxSize&&e.size>t.settings.maxSize)i='Превышен размер файла "'+e.name+'".\nМаксимальный размер - '+Math.round(t.settings.maxSize/1024)+"kb";else{var l=Math.round(e.size/1024),a=e.name;n.append("<li><p>"+a+"</p><span>"+l+"kb</span></li>")}}),t.filesList.empty(),i?(alert(i),t.$element.val("")):t.filesList.append(n)}}]),e}(),Checkbox=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.init(e),_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",n).call(n,"checkbox"),n}return _inherits(t,e),_createClass(t,[{key:"init",value:function(e){var t=this;this.$element=e,this.name=e.attr("name"),this.value=e.val(),this.active=!(!t.$element.prop("checked")&&!t.$element.attr("checked"))}}]),t}(Box),Radio=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),i=n;return n.init(e),_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"create",n).call(n,"radio"),n.button.unbind("click"),n.button.bind("click",function(){i.remove||i.active?i.remove&&i.toogle():i.activate()}),n}return _inherits(t,e),_createClass(t,[{key:"init",value:function(e){var t=this;this.$element=e,this.name=e.attr("name"),this.value=e.val(),this.active=!(!t.$element.prop("checked")&&!t.$element.attr("checked")),this.remove=checkBoolean(t.$element.attr("data-remove"),!1),this.radios=$('input[type=radio][name="'+this.name+'"]'),this.$element[0].inputdecor=this}},{key:"deactiveOther",value:function(e){this.radios.each(function(){this.inputdecor!==e&&this.inputdecor.deactivate()})}},{key:"activate",value:function(){_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"activate",this).call(this),this.deactiveOther(this)}}]),t}(Box),Select=function(){function Select(e){_classCallCheck(this,Select);var t=this;this.$element=e,this.$elements={},this.settings={active:!1,name:e.attr("name"),value:e.val(),speed:parseInt(this.$element.attr("data-speed"))||250,rollup:t.$element.attr("data-rollup")||!1,unselected:t.$element.attr("data-unselected")||!1,unselectedText:t.$element.attr("data-unselected-text")||"Не выбрано",class:this.$element.attr("data-class")||"",changeFunc:this.$element.attr("data-onchange")||function(){},text:t.$element.find("li.active").length?active.text():t.$element.attr("data-text")||"Выберите из списка"},this._build()}return _createClass(Select,[{key:"_build",value:function _build(){var self=this,$elements=this.$elements,settings=this.settings,list="",options;if(this.$element.hide(),settings.unselected){var element=this.$element[0];"select"==element.tagName.toLowerCase()?(this.$element.prepend("<option>"+settings.unselectedText+"</option>"),1==element.selectedIndex&&(element.selectedIndex=0)):"ul"==element.tagName.toLowerCase()&&this.$element.prepend("<li>"+settings.unselectedText+"</li>")}settings.changeFunc=eval("(function(){ return "+settings.changeFunc+"})()"),$elements.select=DOC.create("div",settings.class?settings.class:"inputdecor-select"),$elements.button=DOC.create("button","button").text(settings.text),$elements.label=DOC.create("span","label"),$elements.hidden=DOC.create("input",{type:"hidden",name:settings.name}).val(settings.value),$elements.list=DOC.create("ul","list"),$elements.wrapper=DOC.create("div","list-wrapper",{position:"absolute",width:"100%",transform:"scaleY(0)","transform-origin":"100% 0",transition:settings.speed+"ms"}),this.$element.before($elements.select),$elements.select.append($elements.button),$elements.select.append($elements.label),$elements.select.append($elements.hidden),$elements.select.append($elements.wrapper),$elements.wrapper.append($elements.list),options=this.$element.find("option"),options.length?(options.each(function(){var e=$(this);e.attr("selected")?($elements.hidden.val(e.val()),$elements.button.text(e.text()),list+="<li selected >"+e.text()+"</li>"):list+="<li>"+e.text()+"</li>"}),$elements.select.append(this.$element)):(list=this.$element[0].innerHTML,this.$element.remove()),$elements.list.append(list),settings.rollup&&($elements.rollup=DOC.create("span","rollup"),$elements.list.append($elements.rollup),$elements.rollup.click(function(e){self.close()})),$elements.button.click(function(e){self.toogle()}),$elements.list.click(function(e){if("LI"==e.target.tagName){var t=$(e.target),n=t.attr("value"),i=t.text();$elements.list.find("li").removeAttr("selected"),i==settings.unselectedText?($elements.hidden.val(""),$elements.button.text(settings.text)):(t.attr("selected",""),$elements.hidden.val(n),$elements.button.text(i)),self.close(),self.$element[0].selectedIndex=t.index(),self.$element.change(),settings.changeFunc(n)}}),document.body.addEventListener("click",function(e){e.target.parentNode!=$elements.select[0]&&self.close()}),console.log(this)}},{key:"open",value:function(){this.$elements.wrapper.css("transform","scaleY(1)"),this.$elements.button.addClass("active"),this.$elements.label.addClass("active"),this.settings.active=!0}},{key:"close",value:function(){this.$elements.wrapper.css("transform","scaleY(0)"),this.$elements.button.removeClass("active"),this.$elements.label.removeClass("active"),this.settings.active=!1}},{key:"toogle",value:function(){this.settings.active?this.close():this.open()}}]),Select}();$.fn.decorate=function(){this.each(function(){this.binder=new Decorator($(this))})},$(document).ready(function(){$(".inputdecor").decorate()})}();